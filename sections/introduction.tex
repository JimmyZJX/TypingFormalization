\section{Introduction}

Modern functional programming languages, such as Haskell or OCaml,
use sophisticated forms of type inference. 

However, while being an
important topic in the Programming Languages research, there is little
work on the mechanization of the metatheory of type inference on
theorem provers. In particular we are unaware of any complete
formalization of the type inference algorithms that are the backbone of modern 
functional languages. 

This paper presents the first full mechanical formalization of the metatheory for
higher-ranked polymorphic type inference. The system that we formalize
is the bidirectional type system by Dunfield and
Krishnaswami (DK). The DK type system has two variants (a declarative
and an algorithmic one) that have been been \emph{manually} proved to be
\emph{sound}, \emph{complete} and \emph{decidable}. 

We present 
a mechanical formalization in the Abella theorem prover 
for DK's declarative type system using a different algorithm. We use a
new algorithm for a few different reasons. Firstly, our new algorithm
employs \emph{worklist judgements}, which allow precise capture of the
scope of vairables and simplify the formalization of scoping in a
theorem prover. Secondly, while DK's original formalization comes with very
well-written manual proofs, there are several details missing,
which complicate the task of writing a formla proof. 
Perhaps more importantly, some proofs/lemmas are wrong and it is
not clear how to replace these by other valid proofs/lemmas. 
\bruno{others} 

Despite the use of a different algorithm we prove the
same results by DK, although with significantly different proofs and
proof techniques.  

The calculus and its metatheory
have been fully formalized in the Abella theorem prover\cite{AbellaDesc}. % Add at least one ref to make compile work normally

In summary, the contributions of this paper are:

\begin{itemize}

\item {\bf A full mechanical formalization of type inference with
    higher-ranked types:}

\item {\bf A new algorithm for DK:}

\item {\bf Worlists with inference judgments:}

\item {\bf Abella formalization:} The calculus and its metatheory
have been fully formalized in the Abella theorem prover\cite{AbellaDesc}.

\end{itemize}